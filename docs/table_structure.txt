CREATE TABLE `chat_messages` (
  `message_id` int NOT NULL AUTO_INCREMENT,
  `channel_id` int DEFAULT NULL,
  `anon_id` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL,
  `sender_type` enum('anon','user') COLLATE utf8mb4_unicode_ci DEFAULT 'anon',
  `message_text` text COLLATE utf8mb4_unicode_ci NOT NULL,
  `file_url` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `sent_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `is_edited` tinyint(1) DEFAULT '0',
  `is_deleted` tinyint(1) DEFAULT '0',
  `reply_to_id` int DEFAULT NULL,
  PRIMARY KEY (`message_id`),
  KEY `room_id` (`channel_id`),
  KEY `anon_id` (`anon_id`),
  KEY `fk_reply_to` (`reply_to_id`),
  CONSTRAINT `chat_messages_ibfk_2` FOREIGN KEY (`anon_id`) REFERENCES `chat_anon_id` (`anon_id`) ON DELETE CASCADE,
  CONSTRAINT `fk_reply_to` FOREIGN KEY (`reply_to_id`) REFERENCES `chat_messages` (`message_id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=32 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci