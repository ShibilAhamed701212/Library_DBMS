{% extends "layout.html" %}

{% block title %}Book Catalog{% endblock %}
{% block header_title %}Discover Books{% endblock %}
{% block header_subtitle %}Browse our collection and request items to borrow.{% endblock %}

{% block head %}
<style>
    .catalog-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 2rem;
        margin-top: 1.5rem;
    }
    .book-cover-wrapper {
        position: relative;
        height: 280px;
        background: var(--stat-icon-bg);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }
    .book-cover {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .book-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        text-align: center;
        background: linear-gradient(135deg, var(--primary) 0%, #0063cc 100%);
        color: white;
    }
    .book-placeholder .title-initials {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        opacity: 0.2;
    }
    .book-info {
        padding: 1.25rem;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }
    .book-title {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--text-main);
        margin-bottom: 0.25rem;
    }
    .book-author {
        font-size: 0.875rem;
        color: var(--text-sub);
        margin-bottom: 1rem;
    }
    .badge-float {
        position: absolute;
        top: 12px;
        right: 12px;
        z-index: 2;
    }
</style>
{% endblock %}

{% block content %}
<form action="/member/catalog" method="GET" class="glass-card" style="display: flex; gap: 1rem; padding: 1rem; margin-bottom: 2rem;">
    <span style="font-size: 1.25rem;">üîç</span>
    <input type="text" name="q" value="{{ q }}" class="search-input" placeholder="Search by title, author, or category..." style="border: none; outline: none; flex-grow: 1; background: transparent; color: var(--text-main); font-size: 1rem;">
    <button type="submit" class="btn btn-primary btn-sm">Search</button>
</form>

{% if not books %}
<div style="text-align: center; padding: 5rem; background: var(--card-bg); border-radius: 12px; border: 1px solid var(--border);">
    <div style="font-size: 3rem; margin-bottom: 1rem;">üì≠</div>
    <h3>No books found matching your search.</h3>
    <p style="color: var(--text-sub);">Try a different keyword or browse all books.</p>
    <a href="/member/catalog" class="btn btn-primary" style="margin-top: 1.5rem;">Clear Search</a>
</div>
{% else %}
<div class="catalog-grid">
    {% for b in books %}
    <div class="book-card glass-card" data-title="{{ b.title|lower }}" data-author="{{ b.author|lower }}" data-category="{{ b.category|lower }}">
        <div class="book-cover-wrapper">
            <span class="badge badge-float {{ 'badge-success' if b.available_copies > 0 else 'badge-danger' }}">
                {{ b.available_copies }} left
            </span>
            
            <img src="https://covers.openlibrary.org/b/title/{{ b.title|urlencode }}-M.jpg" 
                 class="book-cover" 
                 alt="{{ b.title }}"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            
            <div class="book-placeholder" style="display: none;">
                <div class="title-initials">{{ b.title[0]|upper }}</div>
                <div style="font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">{{ b.category }}</div>
            </div>
        </div>
        
        <div class="book-info">
            <h3 class="book-title" title="{{ b.title }}">{{ b.title }}</h3>
            <p class="book-author">by {{ b.author }}</p>
            
            <div class="book-meta">
                <span class="badge" style="background: var(--stat-icon-bg); color: var(--primary);">{{ b.category }}</span>
                
                <form action="/member/request" method="POST" style="margin: 0;">
                    <input type="hidden" name="book_id" value="{{ b.book_id }}">
                    <button type="submit" class="btn btn-sm {{ 'btn-primary' if b.available_copies > 0 else 'btn-disabled' }}"
                            {{ 'disabled' if b.available_copies <= 0 }}>
                        Request
                    </button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- PAGINATION CONTROLS -->
<div class="pagination">
    {% if current_page > 1 %}
    <a href="/member/catalog?page={{ current_page - 1 }}&q={{ q }}" class="btn btn-danger btn-sm">Previous</a>
    {% else %}
    <button class="btn btn-disabled btn-sm" disabled>Previous</button>
    {% endif %}

    <span class="page-info">Page <strong>{{ current_page }}</strong> of {{ total_pages }}</span>

    {% if current_page < total_pages %}
    <a href="/member/catalog?page={{ current_page + 1 }}&q={{ q }}" class="btn btn-primary btn-sm">Next</a>
    {% else %}
    <button class="btn btn-disabled btn-sm" disabled>Next</button>
    {% endif %}
</div>
{% endif %}
{% endblock %}
