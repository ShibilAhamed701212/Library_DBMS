
{% extends "layout.html" %}

{% block title %}My Wishlist{% endblock %}
{% block header_title %}My Wishlist{% endblock %}
{% block header_subtitle %}Books you want to read later.{% endblock %}

{% block head %}
<style>
    .catalog-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 2rem;
        margin-top: 1.5rem;
    }
    .book-cover-wrapper { position: relative; height: 280px; background: var(--stat-icon-bg); display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .book-cover { width: 100%; height: 100%; object-fit: cover; }
    .book-title { font-size: 1.125rem; font-weight: 700; color: var(--text-main); margin-bottom: 0.25rem; }
    .book-author { font-size: 0.875rem; color: var(--text-sub); margin-bottom: 1rem; }
</style>
{% endblock %}

{% block content %}

{% if not books %}
<div class="glass-card" style="text-align: center; padding: 4rem;">
    <div style="font-size: 3rem; margin-bottom: 1rem;">‚ù§Ô∏è</div>
    <h3>Your wishlist is empty.</h3>
    <a href="/member/catalog" class="btn btn-primary" style="margin-top: 1rem;">Browse Books</a>
</div>
{% else %}
<div class="catalog-grid">
    {% for b in books %}
    <div class="book-card glass-card">
        <div class="book-cover-wrapper">
            <span class="badge badge-float {{ 'badge-success' if b.available_copies > 0 else 'badge-danger' }}">
                {{ b.available_copies }} left
            </span>
            <img src="https://covers.openlibrary.org/b/title/{{ b.title|urlencode }}-M.jpg" class="book-cover" onerror="this.src='https://placehold.co/240x280?text={{ b.title[0] }}'">
        </div>
        
        <div class="book-info" style="padding: 1.25rem;">
            <h3 class="book-title">{{ b.title }}</h3>
            <p class="book-author">by {{ b.author }}</p>
            
            <div style="display: flex; gap: 0.5rem; align-items: center;">
                {% if b.available_copies > 0 %}
                <form action="/member/request" method="POST" style="margin: 0; flex: 1;">
                    <input type="hidden" name="book_id" value="{{ b.book_id }}">
                    <button type="submit" class="btn btn-sm btn-primary" style="width: 100%;">Request</button>
                </form>
                {% else %}
                <form action="/member/waitlist/join" method="POST" style="margin: 0; flex: 1;">
                    <input type="hidden" name="book_id" value="{{ b.book_id }}">
                    <button type="submit" class="btn btn-sm btn-warning" style="width: 100%;">Waitlist</button>
                </form>
                {% endif %}
                
                <form action="/member/wishlist/remove" method="POST" style="margin: 0;">
                    <input type="hidden" name="book_id" value="{{ b.book_id }}">
                    <button type="submit" class="btn btn-sm btn-danger" title="Remove">üóëÔ∏è</button>
                </form>
            </div>
            <p style="font-size: 0.75rem; color: var(--text-sub); margin-top: 0.5rem;">Added: {{ b.added_at }}</p>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}
