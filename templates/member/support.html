
{% extends "layout.html" %}

{% block title %}Support Tickets{% endblock %}
{% block header_title %}Support Tickets{% endblock %}
{% block header_subtitle %}Get help from our support team.{% endblock %}

{% block content %}
<button class="btn btn-primary" style="margin-bottom: 2rem;" onclick="document.getElementById('newTicketModal').style.display='flex'">
    âž• New Ticket
</button>

<div class="glass-card" style="padding: 0; overflow: hidden;">
    <table style="width: 100%; border-collapse: collapse;">
        <thead style="background: rgba(0,0,0,0.03); border-bottom: 1px solid var(--border);">
            <tr>
                <th style="padding: 1rem; text-align: left;">ID</th>
                <th style="padding: 1rem; text-align: left;">Subject</th>
                <th style="padding: 1rem; text-align: center;">Status</th>
                <th style="padding: 1rem; text-align: right;">Date</th>
                <th style="padding: 1rem;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% if not tickets %}
            <tr><td colspan="5" style="padding: 2rem; text-align: center; color: var(--text-sub);">No tickets yet.</td></tr>
            {% else %}
            {% for t in tickets %}
            <tr style="border-bottom: 1px solid var(--border);">
                <td style="padding: 1rem;">#{{ t.ticket_id }}</td>
                <td style="padding: 1rem; font-weight: 500;">{{ t.subject }}</td>
                <td style="padding: 1rem; text-align: center;">
                    <span class="badge {{ 'badge-success' if t.status == 'closed' else 'badge-primary' }}">
                        {{ t.status|upper }}
                    </span>
                </td>
                <td style="padding: 1rem; text-align: right; color: var(--text-sub);">{{ t.created_at }}</td>
                <td style="padding: 1rem;">
                    <a href="/member/support/{{ t.ticket_id }}" class="btn btn-primary btn-sm">View</a>
                </td>
            </tr>
            {% endfor %}
            {% endif %}
        </tbody>
    </table>
</div>

<!-- Modal -->
<div id="newTicketModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div class="glass-card" style="width: 90%; max-width: 500px; padding: 2rem;">
        <h2 style="margin-top: 0;">New Support Ticket</h2>
        <form action="/member/support" method="POST">
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Subject</label>
                <input type="text" name="subject" required class="form-control" style="width: 100%; padding: 0.8rem; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text-main);">
            </div>
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Message</label>
                <textarea name="message" rows="5" required class="form-control" style="width: 100%; padding: 0.8rem; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text-main); font-family: inherit;"></textarea>
            </div>
            <div style="display: flex; gap: 1rem;">
                <button type="submit" class="btn btn-primary" style="flex: 1;">Create Ticket</button>
                <button type="button" class="btn btn-danger" style="flex: 1;" onclick="document.getElementById('newTicketModal').style.display='none'">Cancel</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
